-- Roblox：登录输入“1”进入。主界面可上下滑动，界面美化，外部有“隐藏界面/显示界面”按钮。含速度/踏空/穿墙/无限跳。

if game.CoreGui:FindFirstChild("MyCustomUI") then game.CoreGui.MyCustomUI:Destroy() end

local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "MyCustomUI"
gui.ResetOnSpawn = false

-- 隐藏/显示按钮（始终置顶）
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.new(0, 80, 0, 36)
toggleBtn.Position = UDim2.new(0, 16, 0, 16)
toggleBtn.BackgroundColor3 = Color3.fromRGB(38,150,255)
toggleBtn.Text = "隐藏界面"
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 18
toggleBtn.AutoButtonColor = true
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1, 0)
toggleBtn.ZIndex = 20

-- 登录界面
local loginFrame = Instance.new("Frame", gui)
loginFrame.Size = UDim2.new(0, 310, 0, 180)
loginFrame.AnchorPoint = Vector2.new(0.5, 0.5)
loginFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
loginFrame.BackgroundColor3 = Color3.fromRGB(30,40,55)
loginFrame.BorderSizePixel = 0
Instance.new("UICorner", loginFrame).CornerRadius = UDim.new(0, 18)
loginFrame.ZIndex = 10

local loginTitle = Instance.new("TextLabel", loginFrame)
loginTitle.Size = UDim2.new(1, 0, 0, 50)
loginTitle.Position = UDim2.new(0,0,0,0)
loginTitle.BackgroundTransparency = 1
loginTitle.Text = "欢迎进入功能面板"
loginTitle.Font = Enum.Font.GothamBold
loginTitle.TextSize = 28
loginTitle.TextColor3 = Color3.fromRGB(0,200,255)
loginTitle.ZIndex = 11

local loginTipText = Instance.new("TextLabel", loginFrame)
loginTipText.Size = UDim2.new(1, -30, 0, 24)
loginTipText.Position = UDim2.new(0,15,0,45)
loginTipText.BackgroundTransparency = 1
loginTipText.Text = "请输入“1”后点击确定进入主界面"
loginTipText.Font = Enum.Font.Gotham
loginTipText.TextSize = 17
loginTipText.TextColor3 = Color3.fromRGB(190, 220, 255)
loginTipText.ZIndex = 11

local loginBox = Instance.new("TextBox", loginFrame)
loginBox.Size = UDim2.new(0.7, 0, 0, 38)
loginBox.Position = UDim2.new(0.15, 0, 0, 80)
loginBox.BackgroundColor3 = Color3.fromRGB(50,60,85)
loginBox.Font = Enum.Font.Gotham
loginBox.PlaceholderText = "在此输入1"
loginBox.Text = ""
loginBox.TextSize = 20
loginBox.TextColor3 = Color3.fromRGB(255,255,255)
loginBox.ClearTextOnFocus = false
Instance.new("UICorner", loginBox).CornerRadius = UDim.new(1,0)
loginBox.ZIndex = 11

local loginBtn = Instance.new("TextButton", loginFrame)
loginBtn.Size = UDim2.new(0.5, 0, 0, 38)
loginBtn.Position = UDim2.new(0.25,0,0, 135)
loginBtn.BackgroundColor3 = Color3.fromRGB(38,150,255)
loginBtn.Text = "确定"
loginBtn.Font = Enum.Font.GothamBold
loginBtn.TextSize = 20
loginBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner",loginBtn).CornerRadius = UDim.new(1,0)
loginBtn.ZIndex = 11

local loginTip = Instance.new("TextLabel", loginFrame)
loginTip.Size = UDim2.new(1,0,0,22)
loginTip.Position = UDim2.new(0,0,1,-22)
loginTip.BackgroundTransparency = 1
loginTip.Text = ""
loginTip.Font = Enum.Font.Gotham
loginTip.TextSize = 15
loginTip.TextColor3 = Color3.fromRGB(240,80,80)
loginTip.ZIndex = 11

local mainFrame = nil

-- 主界面函数
local function showMainUI()
    loginFrame.Visible = false

    -- 外部容器
    local f = Instance.new("Frame", gui)
    mainFrame = f
    f.Size = UDim2.new(0, 400, 0, 330)
    f.AnchorPoint = Vector2.new(0.5, 0.5)
    f.Position = UDim2.new(0.5, 0, 0.5, 0)
    f.BackgroundColor3 = Color3.fromRGB(35, 40, 58)
    f.BorderSizePixel = 0
    Instance.new("UICorner", f).CornerRadius = UDim.new(0, 20)
    f.ZIndex = 10

    -- 顶部装饰栏
    local header = Instance.new("Frame", f)
    header.Size = UDim2.new(1,0,0,50)
    header.Position = UDim2.new(0,0,0,0)
    header.BackgroundColor3 = Color3.fromRGB(38,150,255)
    header.BorderSizePixel = 0
    Instance.new("UICorner", header).CornerRadius = UDim.new(0, 16)
    header.ZIndex = 11

    local l = Instance.new("TextLabel", header)
    l.Size = UDim2.new(1, -56, 1, 0)
    l.Position = UDim2.new(0, 20, 0, 0)
    l.BackgroundTransparency = 1
    l.Text = "人物功能调节"
    l.Font = Enum.Font.GothamBold
    l.TextSize = 28
    l.TextColor3 = Color3.fromRGB(255,255,255)
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.ZIndex = 12

    -- 关闭按钮
    local cb = Instance.new("TextButton", header)
    cb.Size = UDim2.new(0, 38, 0, 38)
    cb.Position = UDim2.new(1, -46, 0, 6)
    cb.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
    cb.Text = "X"
    cb.Font = Enum.Font.GothamBold
    cb.TextSize = 20
    cb.TextColor3 = Color3.fromRGB(255, 255, 255)
    Instance.new("UICorner", cb).CornerRadius = UDim.new(1, 0)
    cb.ZIndex = 13
    cb.MouseButton1Click:Connect(function() gui:Destroy() end)

    -- 拖动
    local dragging, mousePos, framePos = false, nil, nil
    header.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true mousePos = i.Position framePos = f.Position
            i.Changed:Connect(function()
                if i.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    header.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local d = i.Position - mousePos
            f.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + d.X, framePos.Y.Scale, framePos.Y.Offset + d.Y)
        end
    end)
    UIS.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

    -- 滚动区域
    local scroll = Instance.new("ScrollingFrame", f)
    scroll.Position = UDim2.new(0,0,0,54)
    scroll.Size = UDim2.new(1,0,1,-54)
    scroll.BackgroundTransparency = 1
    scroll.CanvasSize = UDim2.new(0,0,0,340)
    scroll.ScrollBarThickness = 8
    scroll.ScrollBarImageColor3 = Color3.fromRGB(38,150,255)
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.ZIndex = 10

    -- 速度
    local sl = Instance.new("TextLabel", scroll)
    sl.Size = UDim2.new(0, 110, 0, 34)
    sl.Position = UDim2.new(0, 28, 0, 16)
    sl.BackgroundTransparency = 1
    sl.Text = "人物速度:"
    sl.Font = Enum.Font.Gotham
    sl.TextSize = 20
    sl.TextColor3 = Color3.fromRGB(255, 255, 255)
    sl.TextXAlignment = Enum.TextXAlignment.Left
    sl.ZIndex = 11

    local sb = Instance.new("TextBox", scroll)
    sb.Size = UDim2.new(0, 82, 0, 34)
    sb.Position = UDim2.new(0, 130, 0, 16)
    sb.BackgroundColor3 = Color3.fromRGB(50, 60, 85)
    sb.Text = ""
    sb.PlaceholderText = "默认16"
    sb.Font = Enum.Font.Gotham
    sb.TextSize = 18
    sb.TextColor3 = Color3.fromRGB(255, 255, 255)
    sb.ClearTextOnFocus = false
    sb.ZIndex = 11
    Instance.new("UICorner", sb).CornerRadius = UDim.new(1, 0)

    local sbtn = Instance.new("TextButton", scroll)
    sbtn.Size = UDim2.new(0, 66, 0, 34)
    sbtn.Position = UDim2.new(0, 224, 0, 16)
    sbtn.BackgroundColor3 = Color3.fromRGB(38,150,255)
    sbtn.Text = "设置"
    sbtn.Font = Enum.Font.Gotham
    sbtn.TextSize = 18
    sbtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    sbtn.ZIndex = 11
    Instance.new("UICorner", sbtn).CornerRadius = UDim.new(1, 0)

    local status = Instance.new("TextLabel", scroll)
    status.Size = UDim2.new(1, -40, 0, 28)
    status.Position = UDim2.new(0, 28, 0, 60)
    status.BackgroundTransparency = 1
    status.Text = ""
    status.Font = Enum.Font.Gotham
    status.TextSize = 18
    status.TextColor3 = Color3.fromRGB(120, 255, 180)
    status.TextXAlignment = Enum.TextXAlignment.Left
    status.ZIndex = 11

    local p = Players.LocalPlayer
    local function getHumanoid()
        local c = p.Character or p.CharacterAdded:Wait()
        return c:FindFirstChildOfClass("Humanoid")
    end

    sbtn.MouseButton1Click:Connect(function()
        local h = getHumanoid()
        if h then
            local v = tonumber(sb.Text)
            if v and v > 0 then
                h.WalkSpeed = v
                status.Text = "人物速度已设置为：" .. v
            else
                status.Text = "请输入有效的速度数值"
            end
        else
            status.Text = "未检测到人物Humanoid"
        end
    end)
    local function updateStatus()
        local h = getHumanoid()
        if h then
            status.Text = string.format("当前速度:%d", h.WalkSpeed)
        else
            status.Text = "未检测到人物Humanoid"
        end
    end
    updateStatus()
    p.CharacterAdded:Connect(function() wait(1) updateStatus() end)

    -- 踏空行走
    local stepWalkEnabled = false
    local stepWalkBtn = Instance.new("TextButton", scroll)
    stepWalkBtn.Size = UDim2.new(0, 140, 0, 40)
    stepWalkBtn.Position = UDim2.new(0, 28, 0, 110)
    stepWalkBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
    stepWalkBtn.Text = "踏空行走：关闭"
    stepWalkBtn.Font = Enum.Font.GothamBold
    stepWalkBtn.TextSize = 20
    stepWalkBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    stepWalkBtn.ZIndex = 11
    Instance.new("UICorner", stepWalkBtn).CornerRadius = UDim.new(1, 0)
    local stepPart = nil
    local stepConn = nil
    local function createStepPart()
        if stepPart and stepPart.Parent then return stepPart end
        stepPart = Instance.new("Part")
        stepPart.Anchored = true
        stepPart.Size = Vector3.new(5, 1, 5)
        stepPart.Transparency = 1
        stepPart.CanCollide = true
        stepPart.Name = "StepAir"
        stepPart.TopSurface = Enum.SurfaceType.Smooth
        stepPart.BottomSurface = Enum.SurfaceType.Smooth
        stepPart.Parent = workspace
        return stepPart
    end
    local function removeStepPart()
        if stepPart then stepPart:Destroy() stepPart = nil end
    end
    local function enableStepWalk(enable)
        stepWalkEnabled = enable
        if enable then
            stepWalkBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
            stepWalkBtn.Text = "踏空行走：开启"
            createStepPart()
            stepConn = game:GetService("RunService").RenderStepped:Connect(function()
                local char = p.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    local hrp = char.HumanoidRootPart
                    stepPart.Position = Vector3.new(hrp.Position.X, hrp.Position.Y - 3.1, hrp.Position.Z)
                else
                    removeStepPart()
                end
            end)
        else
            stepWalkBtn.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
            stepWalkBtn.Text = "踏空行走：关闭"
            if stepConn then stepConn:Disconnect() stepConn = nil end
            removeStepPart()
        end
    end
    stepWalkBtn.MouseButton1Click:Connect(function() enableStepWalk(not stepWalkEnabled) end)
    p.CharacterAdded:Connect(function() wait(1) enableStepWalk(false) end)

    -- 穿墙
    local noclipEnabled = false
    local noclipBtn = Instance.new("TextButton", scroll)
    noclipBtn.Size = UDim2.new(0, 140, 0, 40)
    noclipBtn.Position = UDim2.new(0, 188, 0, 110)
    noclipBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
    noclipBtn.Text = "穿墙：关闭"
    noclipBtn.Font = Enum.Font.GothamBold
    noclipBtn.TextSize = 20
    noclipBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    noclipBtn.ZIndex = 11
    Instance.new("UICorner", noclipBtn).CornerRadius = UDim.new(1, 0)
    local noclipConn = nil
    local function enableNoclip(enable)
        noclipEnabled = enable
        if enable then
            noclipBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
            noclipBtn.Text = "穿墙：开启"
            noclipConn = game:GetService("RunService").Stepped:Connect(function()
                if p.Character and p.Character:FindFirstChildOfClass("Humanoid") then
                    for _, v in pairs(p.Character:GetDescendants()) do
                        if v:IsA("BasePart") and v.CanCollide == true then v.CanCollide = false end
                    end
                end
            end)
        else
            noclipBtn.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
            noclipBtn.Text = "穿墙：关闭"
            if noclipConn then noclipConn:Disconnect() noclipConn = nil end
            if p.Character then
                for _, v in pairs(p.Character:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = true end
                end
            end
        end
    end
    noclipBtn.MouseButton1Click:Connect(function() enableNoclip(not noclipEnabled) end)
    p.CharacterAdded:Connect(function() wait(1) enableNoclip(false) end)

    -- 无限跳
    local infjumpEnabled = false
    local infjumpBtn = Instance.new("TextButton", scroll)
    infjumpBtn.Size = UDim2.new(0, 300, 0, 40)
    infjumpBtn.Position = UDim2.new(0, 50, 0, 170)
    infjumpBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
    infjumpBtn.Text = "无限跳：关闭"
    infjumpBtn.Font = Enum.Font.GothamBold
    infjumpBtn.TextSize = 20
    infjumpBtn.TextColor3 = Color3.fromRGB(255,255,255)
    infjumpBtn.ZIndex = 11
    Instance.new("UICorner", infjumpBtn).CornerRadius = UDim.new(1,0)
    local infjumpConn = nil
    local function enableInfJump(enable)
        infjumpEnabled = enable
        if enable then
            infjumpBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
            infjumpBtn.Text = "无限跳：开启"
            infjumpConn = UIS.JumpRequest:Connect(function()
                local h = getHumanoid()
                if h then
                    h:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end)
        else
            infjumpBtn.BackgroundColor3 = Color3.fromRGB(170,0,0)
            infjumpBtn.Text = "无限跳：关闭"
            if infjumpConn then infjumpConn:Disconnect() infjumpConn = nil end
        end
    end
    infjumpBtn.MouseButton1Click:Connect(function() enableInfJump(not infjumpEnabled) end)
    p.CharacterAdded:Connect(function() wait(1) enableInfJump(false) end)


    -- 分割线
    local sep = Instance.new("Frame", scroll)
    sep.Size = UDim2.new(1, -56, 0, 2)
    sep.Position = UDim2.new(0, 28, 0, 222)
    sep.BackgroundColor3 = Color3.fromRGB(38,150,255)
    sep.BorderSizePixel = 0
    sep.ZIndex = 11

    -- 提示文本
    local tip = Instance.new("TextLabel", scroll)
    tip.Size = UDim2.new(1, -56, 0, 30)
    tip.Position = UDim2.new(0, 28, 0, 240)
    tip.BackgroundTransparency = 1
    tip.Text = "Tony小黄制作"
    tip.Font = Enum.Font.Gotham
    tip.TextSize = 16
    tip.TextColor3 = Color3.fromRGB(190,215,255)
    tip.TextXAlignment = Enum.TextXAlignment.Left
    tip.ZIndex = 11

    -- 滚动区域自动适应内容高度
    scroll.CanvasSize = UDim2.new(0,0,0,280)
end

loginBtn.MouseButton1Click:Connect(function()
    if loginBox.Text == "1" then
        showMainUI()
    else
        loginTip.Text = "输入错误，请输入1"
    end
end)

-- 隐藏/显示主界面逻辑
toggleBtn.MouseButton1Click:Connect(function()
    if mainFrame and mainFrame.Visible then
        mainFrame.Visible = false
        toggleBtn.Text = "显示界面"
    elseif mainFrame then
        mainFrame.Visible = true
        toggleBtn.Text = "隐藏界面"
    end
end)