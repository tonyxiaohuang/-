-- Roblox：登录输入“1”进入。主界面可上下滑动（滑动区域更大），外部有“隐藏界面/显示界面”，含速度/踏空/穿墙/无限跳/上帝模式/锁血/人物自定义旋转/碰到玩家秒杀/选择玩家传送和杀死
-- 优化：窗口更小，滑动距离更长，界面更紧凑

if game.CoreGui:FindFirstChild("MyCustomUI") then game.CoreGui.MyCustomUI:Destroy() end

local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "MyCustomUI"
gui.ResetOnSpawn = false

-- 隐藏/显示按钮
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.new(0, 68, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0, 10)
toggleBtn.BackgroundColor3 = Color3.fromRGB(38,150,255)
toggleBtn.Text = "隐藏界面"
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 16
toggleBtn.AutoButtonColor = true
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1, 0)
toggleBtn.ZIndex = 20

-- 登录界面
local loginFrame = Instance.new("Frame", gui)
loginFrame.Size = UDim2.new(0, 220, 0, 120)
loginFrame.AnchorPoint = Vector2.new(0.5, 0.5)
loginFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
loginFrame.BackgroundColor3 = Color3.fromRGB(30,40,55)
loginFrame.BorderSizePixel = 0
Instance.new("UICorner", loginFrame).CornerRadius = UDim.new(0, 12)
loginFrame.ZIndex = 10

local loginTitle = Instance.new("TextLabel", loginFrame)
loginTitle.Size = UDim2.new(1, 0, 0, 34)
loginTitle.Position = UDim2.new(0,0,0,0)
loginTitle.BackgroundTransparency = 1
loginTitle.Text = "功能面板"
loginTitle.Font = Enum.Font.GothamBold
loginTitle.TextSize = 18
loginTitle.TextColor3 = Color3.fromRGB(0,200,255)
loginTitle.ZIndex = 11

local loginTipText = Instance.new("TextLabel", loginFrame)
loginTipText.Size = UDim2.new(1, -10, 0, 16)
loginTipText.Position = UDim2.new(0,5,0,32)
loginTipText.BackgroundTransparency = 1
loginTipText.Text = "输入“1”后点击确定"
loginTipText.Font = Enum.Font.Gotham
loginTipText.TextSize = 12
loginTipText.TextColor3 = Color3.fromRGB(190, 220, 255)
loginTipText.ZIndex = 11

local loginBox = Instance.new("TextBox", loginFrame)
loginBox.Size = UDim2.new(0.7, 0, 0, 24)
loginBox.Position = UDim2.new(0.15, 0, 0, 54)
loginBox.BackgroundColor3 = Color3.fromRGB(50,60,85)
loginBox.Font = Enum.Font.Gotham
loginBox.PlaceholderText = "在此输入1"
loginBox.Text = ""
loginBox.TextSize = 14
loginBox.TextColor3 = Color3.fromRGB(255,255,255)
loginBox.ClearTextOnFocus = false
Instance.new("UICorner", loginBox).CornerRadius = UDim.new(1,0)
loginBox.ZIndex = 11

local loginBtn = Instance.new("TextButton", loginFrame)
loginBtn.Size = UDim2.new(0.5, 0, 0, 22)
loginBtn.Position = UDim2.new(0.25,0,0, 86)
loginBtn.BackgroundColor3 = Color3.fromRGB(38,150,255)
loginBtn.Text = "确定"
loginBtn.Font = Enum.Font.GothamBold
loginBtn.TextSize = 14
loginBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner",loginBtn).CornerRadius = UDim.new(1,0)
loginBtn.ZIndex = 11

local loginTip = Instance.new("TextLabel", loginFrame)
loginTip.Size = UDim2.new(1,0,0,16)
loginTip.Position = UDim2.new(0,0,1,-16)
loginTip.BackgroundTransparency = 1
loginTip.Text = ""
loginTip.Font = Enum.Font.Gotham
loginTip.TextSize = 12
loginTip.TextColor3 = Color3.fromRGB(240,80,80)
loginTip.ZIndex = 11

local mainFrame = nil

-- 碰撞秒杀功能
local killerTouchConn = nil
local killerEnabled = false
local function enableKillerTouch(enable)
    killerEnabled = enable
    if killerTouchConn then killerTouchConn:Disconnect() killerTouchConn = nil end
    if enable then
        local p = Players.LocalPlayer
        killerTouchConn = RunService.Stepped:Connect(function()
            local char = p.Character
            if not char then return end
            for _, part in ipairs(char:GetChildren()) do
                if part:IsA("BasePart") then
                    part.Touched:Connect(function(hit)
                        local otherChar = hit.Parent
                        if otherChar and otherChar ~= char and Players:GetPlayerFromCharacter(otherChar) then
                            local humanoid = otherChar:FindFirstChildOfClass("Humanoid")
                            if humanoid and humanoid.Health > 0 then
                                humanoid.Health = 0
                            end
                        end
                    end)
                end
            end
        end)
    end
end

Players.LocalPlayer.CharacterAdded:Connect(function()
    if killerEnabled then
        enableKillerTouch(false)
        wait(1)
        enableKillerTouch(true)
    end
end)

-- 人物旋转功能
local rotateConn = nil
local rotateEnabled = false
local rotateSpeed = 180 -- 默认每秒180度
local function enableRotate(enable, speed)
    local p = Players.LocalPlayer
    local function getHRP()
        return (p.Character or p.CharacterAdded:Wait()):FindFirstChild("HumanoidRootPart")
    end
    rotateEnabled = enable
    if rotateConn then rotateConn:Disconnect() rotateConn = nil end
    if enable then
        rotateConn = RunService.RenderStepped:Connect(function(dt)
            local hrp = getHRP()
            if hrp then
                hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(speed or rotateSpeed)*dt, 0)
            end
        end)
    end
end
Players.LocalPlayer.CharacterAdded:Connect(function() if rotateEnabled then enableRotate(true, rotateSpeed) end end)

-- 锁血无敌功能
local lockHealthConn = nil
local lockHealthEnabled = false
local function enableLockHealth(enable)
    local p = Players.LocalPlayer
    lockHealthEnabled = enable
    if lockHealthConn then lockHealthConn:Disconnect() lockHealthConn = nil end
    if enable then
        lockHealthConn = RunService.RenderStepped:Connect(function()
            local char = p.Character
            if char then
                local hum = char:FindFirstChildOfClass("Humanoid")
                if hum and hum.Health < (hum.MaxHealth or 100) then
                    hum.Health = hum.MaxHealth or 100
                end
            end
        end)
    end
end
Players.LocalPlayer.CharacterAdded:Connect(function() if lockHealthEnabled then enableLockHealth(true) end end)

-- 选择玩家传送和杀死功能
local function createPlayerSelect(parent, yOffset)
    local label = Instance.new("TextLabel", parent)
    label.Size = UDim2.new(1, -24, 0, 18)
    label.Position = UDim2.new(0, 12, 0, yOffset)
    label.BackgroundTransparency = 1
    label.Text = "玩家列表："
    label.Font = Enum.Font.GothamBold
    label.TextSize = 13
    label.TextColor3 = Color3.fromRGB(190,215,255)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.ZIndex = 11

    local playerDrop = Instance.new("TextButton", parent)
    playerDrop.Size = UDim2.new(0, 100, 0, 22)
    playerDrop.Position = UDim2.new(0, 12, 0, yOffset + 22)
    playerDrop.BackgroundColor3 = Color3.fromRGB(38,150,255)
    playerDrop.Text = "选择玩家"
    playerDrop.Font = Enum.Font.Gotham
    playerDrop.TextSize = 13
    playerDrop.TextColor3 = Color3.fromRGB(255,255,255)
    playerDrop.ZIndex = 12
    Instance.new("UICorner", playerDrop).CornerRadius = UDim.new(1, 0)

    -- 下拉列表
    local dropdownFrame = Instance.new("Frame", parent)
    dropdownFrame.Size = UDim2.new(0, 100, 0, 90)
    dropdownFrame.Position = UDim2.new(0, 12, 0, yOffset + 46)
    dropdownFrame.BackgroundColor3 = Color3.fromRGB(30, 60, 100)
    dropdownFrame.Visible = false
    dropdownFrame.BorderSizePixel = 0
    dropdownFrame.ZIndex = 30
    Instance.new("UICorner", dropdownFrame).CornerRadius = UDim.new(0, 8)

    local listLayout = Instance.new("UIListLayout", dropdownFrame)
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 2)

    local selectedPlayer = nil

    local function refreshPlayerList()
        for _,v in ipairs(dropdownFrame:GetChildren()) do
            if v:IsA("TextButton") then v:Destroy() end
        end
        for _,plr in ipairs(Players:GetPlayers()) do
            if plr ~= Players.LocalPlayer then
                local btn = Instance.new("TextButton", dropdownFrame)
                btn.Size = UDim2.new(1, -6, 0, 18)
                btn.BackgroundColor3 = Color3.fromRGB(58,180,255)
                btn.Text = plr.Name
                btn.Font = Enum.Font.Gotham
                btn.TextSize = 13
                btn.TextColor3 = Color3.fromRGB(255,255,255)
                btn.ZIndex = 31
                Instance.new("UICorner", btn).CornerRadius = UDim.new(1,0)
                btn.MouseButton1Click:Connect(function()
                    selectedPlayer = plr
                    playerDrop.Text = plr.Name
                    dropdownFrame.Visible = false
                end)
            end
        end
    end

    playerDrop.MouseButton1Click:Connect(function()
        dropdownFrame.Visible = not dropdownFrame.Visible
        if dropdownFrame.Visible then
            refreshPlayerList()
        end
    end)

    -- 传送按钮
    local tpBtn = Instance.new("TextButton", parent)
    tpBtn.Size = UDim2.new(0, 56, 0, 22)
    tpBtn.Position = UDim2.new(0, 120, 0, yOffset + 22)
    tpBtn.BackgroundColor3 = Color3.fromRGB(70,220,170)
    tpBtn.Text = "传送到"
    tpBtn.Font = Enum.Font.GothamBold
    tpBtn.TextSize = 13
    tpBtn.TextColor3 = Color3.fromRGB(255,255,255)
    tpBtn.ZIndex = 12
    Instance.new("UICorner", tpBtn).CornerRadius = UDim.new(1,0)
    tpBtn.MouseButton1Click:Connect(function()
        if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local p = Players.LocalPlayer
            local myChar = p.Character
            if myChar and myChar:FindFirstChild("HumanoidRootPart") then
                myChar.HumanoidRootPart.CFrame = selectedPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
            end
        end
    end)

    -- 杀死按钮
    local killBtn = Instance.new("TextButton", parent)
    killBtn.Size = UDim2.new(0, 48, 0, 22)
    killBtn.Position = UDim2.new(0, 182, 0, yOffset + 22)
    killBtn.BackgroundColor3 = Color3.fromRGB(255,60,60)
    killBtn.Text = "杀死"
    killBtn.Font = Enum.Font.GothamBold
    killBtn.TextSize = 13
    killBtn.TextColor3 = Color3.fromRGB(255,255,255)
    killBtn.ZIndex = 12
    Instance.new("UICorner", killBtn).CornerRadius = UDim.new(1,0)
    killBtn.MouseButton1Click:Connect(function()
        if selectedPlayer and selectedPlayer.Character then
            local h = selectedPlayer.Character:FindFirstChildOfClass("Humanoid")
            if h then
                h.Health = 0
            end
        end
    end)

    return dropdownFrame
end

-- 主界面函数
local function showMainUI()
    loginFrame.Visible = false

    -- 外部容器
    local f = Instance.new("Frame", gui)
    mainFrame = f
    f.Size = UDim2.new(0, 250, 0, 330)
    f.AnchorPoint = Vector2.new(0.5, 0.5)
    f.Position = UDim2.new(0.5, 0, 0.5, 0)
    f.BackgroundColor3 = Color3.fromRGB(35, 40, 58)
    f.BorderSizePixel = 0
    Instance.new("UICorner", f).CornerRadius = UDim.new(0, 14)
    f.ZIndex = 10

    -- 顶部装饰栏
    local header = Instance.new("Frame", f)
    header.Size = UDim2.new(1,0,0,36)
    header.Position = UDim2.new(0,0,0,0)
    header.BackgroundColor3 = Color3.fromRGB(38,150,255)
    header.BorderSizePixel = 0
    Instance.new("UICorner", header).CornerRadius = UDim.new(0, 10)
    header.ZIndex = 11

    local l = Instance.new("TextLabel", header)
    l.Size = UDim2.new(1, -36, 1, 0)
    l.Position = UDim2.new(0, 16, 0, 0)
    l.BackgroundTransparency = 1
    l.Text = "功能调节"
    l.Font = Enum.Font.GothamBold
    l.TextSize = 16
    l.TextColor3 = Color3.fromRGB(255,255,255)
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.ZIndex = 12

    -- 关闭按钮
    local cb = Instance.new("TextButton", header)
    cb.Size = UDim2.new(0, 26, 0, 26)
    cb.Position = UDim2.new(1, -32, 0, 5)
    cb.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
    cb.Text = "X"
    cb.Font = Enum.Font.GothamBold
    cb.TextSize = 13
    cb.TextColor3 = Color3.fromRGB(255, 255, 255)
    Instance.new("UICorner", cb).CornerRadius = UDim.new(1, 0)
    cb.ZIndex = 13
    cb.MouseButton1Click:Connect(function() 
        if rotateConn then rotateConn:Disconnect() end
        if killerTouchConn then killerTouchConn:Disconnect() end
        if lockHealthConn then lockHealthConn:Disconnect() end
        gui:Destroy()
    end)

    -- 拖动
    local dragging, mousePos, framePos = false, nil, nil
    header.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true mousePos = i.Position framePos = f.Position
            i.Changed:Connect(function()
                if i.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    header.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local d = i.Position - mousePos
            f.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + d.X, framePos.Y.Scale, framePos.Y.Offset + d.Y)
        end
    end)
    UIS.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

    -- 滚动区域
    local scroll = Instance.new("ScrollingFrame", f)
    scroll.Position = UDim2.new(0,0,0,36)
    scroll.Size = UDim2.new(1,0,1,-36)
    scroll.BackgroundTransparency = 1
    scroll.CanvasSize = UDim2.new(0,0,0,1200) -- 滑动区域更长
    scroll.ScrollBarThickness = 6
    scroll.ScrollBarImageColor3 = Color3.fromRGB(38,150,255)
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.ZIndex = 10

    -- 速度
    local sl = Instance.new("TextLabel", scroll)
    sl.Size = UDim2.new(0, 70, 0, 22)
    sl.Position = UDim2.new(0, 12, 0, 10)
    sl.BackgroundTransparency = 1
    sl.Text = "速度:"
    sl.Font = Enum.Font.Gotham
    sl.TextSize = 13
    sl.TextColor3 = Color3.fromRGB(255, 255, 255)
    sl.TextXAlignment = Enum.TextXAlignment.Left
    sl.ZIndex = 11

    local sb = Instance.new("TextBox", scroll)
    sb.Size = UDim2.new(0, 48, 0, 22)
    sb.Position = UDim2.new(0, 62, 0, 10)
    sb.BackgroundColor3 = Color3.fromRGB(50, 60, 85)
    sb.Text = ""
    sb.PlaceholderText = "16"
    sb.Font = Enum.Font.Gotham
    sb.TextSize = 13
    sb.TextColor3 = Color3.fromRGB(255, 255, 255)
    sb.ClearTextOnFocus = false
    sb.ZIndex = 11
    Instance.new("UICorner", sb).CornerRadius = UDim.new(1, 0)

    local sbtn = Instance.new("TextButton", scroll)
    sbtn.Size = UDim2.new(0, 38, 0, 22)
    sbtn.Position = UDim2.new(0, 116, 0, 10)
    sbtn.BackgroundColor3 = Color3.fromRGB(38,150,255)
    sbtn.Text = "设定"
    sbtn.Font = Enum.Font.Gotham
    sbtn.TextSize = 13
    sbtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    sbtn.ZIndex = 11
    Instance.new("UICorner", sbtn).CornerRadius = UDim.new(1, 0)

    local status = Instance.new("TextLabel", scroll)
    status.Size = UDim2.new(1, -24, 0, 18)
    status.Position = UDim2.new(0, 12, 0, 36)
    status.BackgroundTransparency = 1
    status.Text = ""
    status.Font = Enum.Font.Gotham
    status.TextSize = 12
    status.TextColor3 = Color3.fromRGB(120, 255, 180)
    status.TextXAlignment = Enum.TextXAlignment.Left
    status.ZIndex = 11

    local p = Players.LocalPlayer
    local function getHumanoid()
        local c = p.Character or p.CharacterAdded:Wait()
        return c:FindFirstChildOfClass("Humanoid")
    end

    sbtn.MouseButton1Click:Connect(function()
        local h = getHumanoid()
        if h then
            local v = tonumber(sb.Text)
            if v and v > 0 then
                h.WalkSpeed = v
                status.Text = "速度已设置为：" .. v
            else
                status.Text = "请输入有效的速度数值"
            end
        else
            status.Text = "未检测到人物Humanoid"
        end
    end)
    local function updateStatus()
        local h = getHumanoid()
        if h then
            status.Text = string.format("当前速度:%d", h.WalkSpeed)
        else
            status.Text = "未检测到人物Humanoid"
        end
    end
    updateStatus()
    p.CharacterAdded:Connect(function() wait(1) updateStatus() end)

    -- 踏空行走
    local stepWalkEnabled = false
    local stepWalkBtn = Instance.new("TextButton", scroll)
    stepWalkBtn.Size = UDim2.new(0, 90, 0, 22)
    stepWalkBtn.Position = UDim2.new(0, 12, 0, 62)
    stepWalkBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
    stepWalkBtn.Text = "踏空：关"
    stepWalkBtn.Font = Enum.Font.GothamBold
    stepWalkBtn.TextSize = 13
    stepWalkBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    stepWalkBtn.ZIndex = 11
    Instance.new("UICorner", stepWalkBtn).CornerRadius = UDim.new(1, 0)
    local stepPart = nil
    local stepConn = nil
    local function createStepPart()
        if stepPart and stepPart.Parent then return stepPart end
        stepPart = Instance.new("Part")
        stepPart.Anchored = true
        stepPart.Size = Vector3.new(5, 1, 5)
        stepPart.Transparency = 1
        stepPart.CanCollide = true
        stepPart.Name = "StepAir"
        stepPart.TopSurface = Enum.SurfaceType.Smooth
        stepPart.BottomSurface = Enum.SurfaceType.Smooth
        stepPart.Parent = workspace
        return stepPart
    end
    local function removeStepPart()
        if stepPart then stepPart:Destroy() stepPart = nil end
    end
    local function enableStepWalk(enable)
        stepWalkEnabled = enable
        if enable then
            stepWalkBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
            stepWalkBtn.Text = "踏空：开"
            createStepPart()
            stepConn = RunService.RenderStepped:Connect(function()
                local char = p.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    local hrp = char.HumanoidRootPart
                    stepPart.Position = Vector3.new(hrp.Position.X, hrp.Position.Y - 3.1, hrp.Position.Z)
                else
                    removeStepPart()
                end
            end)
        else
            stepWalkBtn.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
            stepWalkBtn.Text = "踏空：关"
            if stepConn then stepConn:Disconnect() stepConn = nil end
            removeStepPart()
        end
    end
    stepWalkBtn.MouseButton1Click:Connect(function() enableStepWalk(not stepWalkEnabled) end)
    p.CharacterAdded:Connect(function() wait(1) enableStepWalk(false) end)

    -- 穿墙
    local noclipEnabled = false
    local noclipBtn = Instance.new("TextButton", scroll)
    noclipBtn.Size = UDim2.new(0, 90, 0, 22)
    noclipBtn.Position = UDim2.new(0, 120, 0, 62)
    noclipBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
    noclipBtn.Text = "穿墙：关"
    noclipBtn.Font = Enum.Font.GothamBold
    noclipBtn.TextSize = 13
    noclipBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    noclipBtn.ZIndex = 11
    Instance.new("UICorner", noclipBtn).CornerRadius = UDim.new(1, 0)
    local noclipConn = nil
    local function enableNoclip(enable)
        noclipEnabled = enable
        if enable then
            noclipBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
            noclipBtn.Text = "穿墙：开"
            noclipConn = RunService.Stepped:Connect(function()
                if p.Character and p.Character:FindFirstChildOfClass("Humanoid") then
                    for _, v in pairs(p.Character:GetDescendants()) do
                        if v:IsA("BasePart") and v.CanCollide == true then v.CanCollide = false end
                    end
                end
            end)
        else
            noclipBtn.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
            noclipBtn.Text = "穿墙：关"
            if noclipConn then noclipConn:Disconnect() noclipConn = nil end
            if p.Character then
                for _, v in pairs(p.Character:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = true end
                end
            end
        end
    end
    noclipBtn.MouseButton1Click:Connect(function() enableNoclip(not noclipEnabled) end)
    p.CharacterAdded:Connect(function() wait(1) enableNoclip(false) end)

    -- 无限跳
    local infjumpEnabled = false
    local infjumpBtn = Instance.new("TextButton", scroll)
    infjumpBtn.Size = UDim2.new(0, 205, 0, 22)
    infjumpBtn.Position = UDim2.new(0, 12, 0, 96)
    infjumpBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
    infjumpBtn.Text = "无限跳：关"
    infjumpBtn.Font = Enum.Font.GothamBold
    infjumpBtn.TextSize = 13
    infjumpBtn.TextColor3 = Color3.fromRGB(255,255,255)
    infjumpBtn.ZIndex = 11
    Instance.new("UICorner", infjumpBtn).CornerRadius = UDim.new(1,0)
    local infjumpConn = nil
    local function enableInfJump(enable)
        infjumpEnabled = enable
        if enable then
            infjumpBtn.BackgroundColor3 = Color3.fromRGB(95, 225, 105)
            infjumpBtn.Text = "无限跳：开"
            infjumpConn = UIS.JumpRequest:Connect(function()
                local h = getHumanoid()
                if h then
                    h:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end)
        else
            infjumpBtn.BackgroundColor3 = Color3.fromRGB(170,0,0)
            infjumpBtn.Text = "无限跳：关"
            if infjumpConn then infjumpConn:Disconnect() infjumpConn = nil end
        end
    end
    infjumpBtn.MouseButton1Click:Connect(function() enableInfJump(not infjumpEnabled) end)
    p.CharacterAdded:Connect(function() wait(1) enableInfJump(false) end)

    -- 上帝模式
    local godEnabled = false
    local godBtn = Instance.new("TextButton", scroll)
    godBtn.Size = UDim2.new(0, 90, 0, 22)
    godBtn.Position = UDim2.new(0, 12, 0, 130)
    godBtn.BackgroundColor3 = Color3.fromRGB(255, 225, 70)
    godBtn.Text = "上帝：关"
    godBtn.Font = Enum.Font.GothamBold
    godBtn.TextSize = 13
    godBtn.TextColor3 = Color3.fromRGB(50,50,50)
    godBtn.ZIndex = 11
    Instance.new("UICorner", godBtn).CornerRadius = UDim.new(1,0)
    local godConn = nil
    local function enableGodMode(enable)
        godEnabled = enable
        if enable then
            godBtn.BackgroundColor3 = Color3.fromRGB(255, 225, 70)
            godBtn.Text = "上帝：开"
            -- 持续让人物无敌
            godConn = RunService.RenderStepped:Connect(function()
                local h = getHumanoid()
                if h then
                    h.Health = h.MaxHealth or 100
                    h.NameDisplayDistance = 0
                    h.BreakJointsOnDeath = false
                    h.PlatformStand = false
                    h:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
                    h:SetStateEnabled(Enum.HumanoidStateType.Physics, true)
                end
            end)
        else
            godBtn.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
            godBtn.Text = "上帝：关"
            if godConn then godConn:Disconnect() godConn = nil end
            local h = getHumanoid()
            if h then
                h:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
                h.NameDisplayDistance = 100
            end
        end
    end
    godBtn.MouseButton1Click:Connect(function() enableGodMode(not godEnabled) end)
    p.CharacterAdded:Connect(function() wait(1) enableGodMode(false) end)

    -- 锁血无敌
    local lockHealthBtn = Instance.new("TextButton", scroll)
    lockHealthBtn.Size = UDim2.new(0, 90, 0, 22)
    lockHealthBtn.Position = UDim2.new(0, 120, 0, 130)
    lockHealthBtn.BackgroundColor3 = Color3.fromRGB(60, 220, 90)
    lockHealthBtn.Text = "锁血：关"
    lockHealthBtn.Font = Enum.Font.GothamBold
    lockHealthBtn.TextSize = 13
    lockHealthBtn.TextColor3 = Color3.fromRGB(255,255,255)
    lockHealthBtn.ZIndex = 11
    Instance.new("UICorner", lockHealthBtn).CornerRadius = UDim.new(1,0)
    local function updateLockHealthBtn()
        if lockHealthEnabled then
            lockHealthBtn.BackgroundColor3 = Color3.fromRGB(120, 255, 110)
            lockHealthBtn.Text = "锁血：开"
        else
            lockHealthBtn.BackgroundColor3 = Color3.fromRGB(60,220,90)
            lockHealthBtn.Text = "锁血：关"
        end
    end
    lockHealthBtn.MouseButton1Click:Connect(function()
        lockHealthEnabled = not lockHealthEnabled
        enableLockHealth(lockHealthEnabled)
        updateLockHealthBtn()
    end)
    updateLockHealthBtn()

    -- 玩家碰撞秒杀开关
    local killerBtn = Instance.new("TextButton", scroll)
    killerBtn.Size = UDim2.new(0, 205, 0, 22)
    killerBtn.Position = UDim2.new(0, 12, 0, 164)
    killerBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 160)
    killerBtn.Text = "碰到玩家秒杀：关"
    killerBtn.Font = Enum.Font.GothamBold
    killerBtn.TextSize = 13
    killerBtn.TextColor3 = Color3.fromRGB(255,255,255)
    killerBtn.ZIndex = 11
    Instance.new("UICorner", killerBtn).CornerRadius = UDim.new(1,0)
    local function updateKillerBtn()
        if killerEnabled then
            killerBtn.BackgroundColor3 = Color3.fromRGB(255, 120, 200)
            killerBtn.Text = "碰到玩家秒杀：开"
        else
            killerBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 160)
            killerBtn.Text = "碰到玩家秒杀：关"
        end
    end
    killerBtn.MouseButton1Click:Connect(function()
        killerEnabled = not killerEnabled
        enableKillerTouch(killerEnabled)
        updateKillerBtn()
    end)
    updateKillerBtn()

    -- 选择玩家传送和杀死
    createPlayerSelect(scroll, 200)

    -- 人物旋转
    local rotateBtn = Instance.new("TextButton", scroll)
    rotateBtn.Size = UDim2.new(0, 130, 0, 22)
    rotateBtn.Position = UDim2.new(0, 12, 0, 270)
    rotateBtn.BackgroundColor3 = Color3.fromRGB(100, 180, 255)
    rotateBtn.Text = "人物旋转：关"
    rotateBtn.Font = Enum.Font.GothamBold
    rotateBtn.TextSize = 13
    rotateBtn.TextColor3 = Color3.fromRGB(50,50,50)
    rotateBtn.ZIndex = 11
    Instance.new("UICorner", rotateBtn).CornerRadius = UDim.new(1,0)

    local rotateSpeedBox = Instance.new("TextBox", scroll)
    rotateSpeedBox.Size = UDim2.new(0, 56, 0, 22)
    rotateSpeedBox.Position = UDim2.new(0, 150, 0, 270)
    rotateSpeedBox.BackgroundColor3 = Color3.fromRGB(70,90,140)
    rotateSpeedBox.Text = tostring(rotateSpeed)
    rotateSpeedBox.PlaceholderText = "转速"
    rotateSpeedBox.Font = Enum.Font.Gotham
    rotateSpeedBox.TextSize = 13
    rotateSpeedBox.TextColor3 = Color3.fromRGB(255,255,255)
    rotateSpeedBox.ClearTextOnFocus = false
    rotateSpeedBox.ZIndex = 11
    Instance.new("UICorner", rotateSpeedBox).CornerRadius = UDim.new(1,0)

    local function updateRotateState()
        if rotateEnabled then
            rotateBtn.BackgroundColor3 = Color3.fromRGB(100,180,255)
            rotateBtn.Text = "人物旋转：开"
        else
            rotateBtn.BackgroundColor3 = Color3.fromRGB(170,170,170)
            rotateBtn.Text = "人物旋转：关"
        end
    end
    rotateBtn.MouseButton1Click:Connect(function()
        rotateEnabled = not rotateEnabled
        if rotateEnabled then
            local speed = tonumber(rotateSpeedBox.Text) or rotateSpeed
            rotateSpeed = speed
            enableRotate(true, rotateSpeed)
        else
            enableRotate(false)
        end
        updateRotateState()
    end)
    rotateSpeedBox.FocusLost:Connect(function(enter)
        if rotateEnabled then
            local newspeed = tonumber(rotateSpeedBox.Text)
            if newspeed and newspeed > 0 then
                rotateSpeed = newspeed
                enableRotate(true, rotateSpeed)
            end
        end
    end)
    updateRotateState()

    -- 分割线
    local sep = Instance.new("Frame", scroll)
    sep.Size = UDim2.new(1, -18, 0, 1)
    sep.Position = UDim2.new(0, 9, 0, 305)
    sep.BackgroundColor3 = Color3.fromRGB(38,150,255)
    sep.BorderSizePixel = 0
    sep.ZIndex = 11

    -- 提示文本
    local tip = Instance.new("TextLabel", scroll)
    tip.Size = UDim2.new(1, -18, 0, 40)
    tip.Position = UDim2.new(0, 9, 0, 312)
    tip.BackgroundTransparency = 1
    tip.Text = "说明：踏空=空气墙，穿墙=Noclip，无限跳=多段跳，上帝/锁血=无敌，碰到玩家=秒杀，选择玩家可传送/杀死，旋转可自定义速度。窗口更小，滑动更长。"
    tip.Font = Enum.Font.Gotham
    tip.TextSize = 12
    tip.TextColor3 = Color3.fromRGB(190,215,255)
    tip.TextXAlignment = Enum.TextXAlignment.Left
    tip.ZIndex = 11

    scroll.CanvasSize = UDim2.new(0,0,0,1200)
end

loginBtn.MouseButton1Click:Connect(function()
    if loginBox.Text == "1" then
        showMainUI()
    else
        loginTip.Text = "输入错误，请输入1"
    end
end)

toggleBtn.MouseButton1Click:Connect(function()
    if mainFrame and mainFrame.Visible then
        mainFrame.Visible = false
        toggleBtn.Text = "显示界面"
    elseif mainFrame then
        mainFrame.Visible = true
        toggleBtn.Text = "隐藏界面"
    end
end)
-- 全图高亮功能
local highlightEnabled = false
local highlightBtn = Instance.new("TextButton", scroll)
highlightBtn.Size = UDim2.new(0, 205, 0, 22)
highlightBtn.Position = UDim2.new(0, 12, 0, 300)
highlightBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 40)
highlightBtn.Text = "全图高亮：关"
highlightBtn.Font = Enum.Font.GothamBold
highlightBtn.TextSize = 13
highlightBtn.TextColor3 = Color3.fromRGB(80, 80, 40)
highlightBtn.ZIndex = 11
Instance.new("UICorner", highlightBtn).CornerRadius = UDim.new(1, 0)
local highlights = {}

local function setHighlightAll(enable)
    highlightEnabled = enable
    if enable then
        highlightBtn.BackgroundColor3 = Color3.fromRGB(255, 230, 110)
        highlightBtn.Text = "全图高亮：开"
        -- 高亮所有BasePart
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("BasePart") and not highlights[v] then
                local hl = Instance.new("Highlight")
                hl.FillColor = Color3.fromRGB(255, 220, 80)
                hl.OutlineColor = Color3.fromRGB(255, 255, 120)
                hl.Adornee = v
                hl.Parent = v
                highlights[v] = hl
            end
        end
    else
        highlightBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 40)
        highlightBtn.Text = "全图高亮：关"
        -- 移除所有高亮
        for v, hl in pairs(highlights) do
            if hl and hl.Parent then hl:Destroy() end
        end
        highlights = {}
    end
end

highlightBtn.MouseButton1Click:Connect(function()
    setHighlightAll(not highlightEnabled)
end)
-- 玩家重生时自动关闭高亮
Players.LocalPlayer.CharacterAdded:Connect(function()
    setHighlightAll(false)
end)